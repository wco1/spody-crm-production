# üîó –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫** —Å UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ **–†–µ–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –≤–º–µ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
- ‚úÖ **Middleware** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

## üìã –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `database-setup.sql` –≤ –≤–∞—à–µ–π Supabase –∫–æ–Ω—Å–æ–ª–∏:

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ database-setup.sql
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```env
NEXT_PUBLIC_APP_URL=http://localhost:3000  # –í–∞—à –¥–æ–º–µ–Ω –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ –∫–ª—é—á–∏ Supabase –≤ test-tracking-system.js
node test-tracking-system.js
```

## üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/tracking`
2. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Facebook –†–µ–∫–ª–∞–º–∞")
   - **–ò—Å—Ç–æ—á–Ω–∏–∫**: utm_source (facebook, google, telegram)
   - **–ö–∞–Ω–∞–ª**: utm_medium (cpc, social, email)
   - **–ö–∞–º–ø–∞–Ω–∏—è**: utm_campaign (summer_sale, launch)
   - **–ö–æ–Ω—Ç–µ–Ω—Ç**: utm_content (banner_top, text_link)
   - **–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ**: utm_term (ai chatbot, crm)

4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Å—Å—ã–ª–∫—É –≤–∏–¥–∞:
   ```
   https://yoursite.com?utm_source=facebook&utm_medium=cpc&utm_campaign=summer_sale&ref=ABC123XY
   ```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- üîç **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç** –≤—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ UTM-—Å—Å—ã–ª–∫–∞–º
- üíæ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç** –¥–∞–Ω–Ω—ã–µ –≤ cookies –Ω–∞ 30 –¥–Ω–µ–π
- üìä **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç** –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìà **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç** —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `tracking_links`
```sql
- id: UUID (Primary Key)
- name: VARCHAR(255) - –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
- code: VARCHAR(50) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
- source: VARCHAR(100) - UTM –∏—Å—Ç–æ—á–Ω–∏–∫
- medium: VARCHAR(100) - UTM –∫–∞–Ω–∞–ª
- campaign: VARCHAR(100) - UTM –∫–∞–º–ø–∞–Ω–∏—è
- content: VARCHAR(100) - UTM –∫–æ–Ω—Ç–µ–Ω—Ç
- term: VARCHAR(100) - UTM –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- url: TEXT - –ü–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞
- is_active: BOOLEAN - –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å—Å—ã–ª–∫–∞
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### –¢–∞–±–ª–∏—Ü–∞ `user_traffic_sources`
```sql
- id: UUID (Primary Key)
- user_id: UUID - –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- tracking_link_id: UUID - –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É
- utm_source: VARCHAR(100)
- utm_medium: VARCHAR(100)
- utm_campaign: VARCHAR(100)
- utm_content: VARCHAR(100)
- utm_term: VARCHAR(100)
- referrer_url: TEXT - URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- referrer_category: VARCHAR(50) - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- first_visit_at: TIMESTAMP - –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è
- created_at: TIMESTAMP
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
```
https://yoursite.com?utm_source=facebook&utm_medium=cpc&ref=ABC123
```

### 2. Middleware —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ cookies:
{
  utm_source: "facebook",
  utm_medium: "cpc", 
  utm_campaign: "summer_sale",
  ref: "ABC123",
  referrer: "https://facebook.com",
  timestamp: 1703123456789
}
```

### 3. –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫
```javascript
// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
await saveUserTrafficSource(userId);
```

### 4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- üìä –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–µ
- üéØ –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫ (`/tracking`)
- üìã **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫** —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚ûï **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è** –Ω–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫, –∫–ª–∏–∫–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã—Ö
- üîó **–î–µ–π—Å—Ç–≤–∏—è**: –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç–∫—Ä—ã—Ç—å, —É–¥–∞–ª–∏—Ç—å
- üì± **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (`/analytics`)
- üìä **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤–º–µ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö
- üéØ **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- üìà **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É

## üîß API Endpoints

### `GET /api/tracking-links`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

### `POST /api/tracking-links`
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É
```json
{
  "name": "Facebook –†–µ–∫–ª–∞–º–∞",
  "source": "facebook",
  "medium": "cpc",
  "campaign": "summer_sale"
}
```

### `DELETE /api/tracking-links?id=UUID`
–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π**
- ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞** —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

- üì± **–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- üñ•Ô∏è **–î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è** —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- üìä **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
- üé® **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω** —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

## üîç –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏:

- **üîç –ü–æ–∏—Å–∫**: google, yandex, bing
- **üì± –°–æ—Ü—Å–µ—Ç–∏**: facebook, instagram, telegram, vk
- **üìß Email**: email —Ä–∞—Å—Å—ã–ª–∫–∏
- **üîó –†–µ—Ñ–µ—Ä–∞–ª—ã**: –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å–∞–π—Ç—ã
- **üí∞ –†–µ–∫–ª–∞–º–∞**: –ø–ª–∞—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ (cpc, ppc)
- **üè† –ü—Ä—è–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã**: –±–µ–∑ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **‚ùì –î—Ä—É–≥–∏–µ**: –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ** SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ** –Ω–∞ `/tracking` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** –∞–Ω–∞–ª–∏—Ç–∏–∫—É –Ω–∞ `/analytics`
5. **–ù–∞—á–Ω–∏—Ç–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –≤ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏—è—Ö

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ CRM –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö —Ç—Ä–∞—Ñ–∏–∫–∞ –≤–º–µ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ! 